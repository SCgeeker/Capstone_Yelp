---
title: 'Capstone: Yelp Data Analysis'
author: "Sau-Chin Chen"
output: html_document
---
```{r initial, cache.path="../Yelp_Data", echo=FALSE, results='hide', warning=FALSE, message=FALSE}
load("../Yelp_Data/Raw.RData")
source("./packageskit.R")
source("./functions.R")
yelp_business <- data.frame(yelp_business, Loc = City_Tag(yelp_business$latitude, yelp_business$longitude))
```

# Get Data

This project will analyze the data set from [Yelp Dataset Challenge](http://www.yelp.com/dataset_challenge). The data set is downloaded from [this link](https://d396qusza40orc.cloudfront.net/dsscapstone/dataset/yelp_dataset_challenge_academic_dataset.zip). I obtained and pre-processed the data set through the codes in [0GetData.R](0GetData.R). Here are files compressed in the zip file:

```{r overview, cache.path="../Yelp_Data", echo=FALSE, warning=FALSE}
print(unzip("../Yelp_Data/yelp.zip", list = TRUE))
```

Yelp is collecting the users' review for the businesses around the major cities across North America and Europe. Data set *business* collects the information from `r dim(yelp_business)[1]` businesses. Data set *checkin* stores `r dim(yelp_checkin)[1]` durations and frequencies a user stay in every business. Data set *review* sumarizes `r dim(yelp_review)[1]` reviews for a registed business. Data set *tip* summarizes the `r dim(yelp_tip)[1]` recommendations for a business. Data set *user* collects the information from  `r dim(yelp_user)[1]` registed users.

# Adjust the locations of businesses
Although each bussines in the business data set has the information of its location (full_address, city, state), these information are a mass because there are many users' typo. We use the geographical information (longitude, latitude) to adjust the location of each business. The result is that we add the new column 'Loc' to the business data set with the following codes.

```{r update_business, cache.path="../Yelp_Data", results='hide'}
yelp_business <- data.frame(yelp_business, Loc = City_Tag(yelp_business$latitude, yelp_business$longitude))
```


# Question and hypothesis

If the data set could show us the variables how users evaluate a businesses, Will we figure a global standard across cities or many local standards in each city?  
If one set of variables gathered from one city could cluster the businesses in the other city, they represent the global standard for this business. Otherwise, every city has the local standard. 

# Explore Raw Business Data
When we focus on the one category of business, such as Pizza or Chinese restaurants, we could compute the relations of attributes and stars of businesses. At first, We calcuated how many categories are collected in the data set and how many businesses are labeled in every category. Here are the top 30 categories. We find out some comparable categories in this list. For example, "Fast Food" and "Pizza"; "Chinese" and "Italian".

```{r categories, cache.path="../Yelp_Data", echo=FALSE, warning=FALSE, message=FALSE}
sort( table(unlist(yelp_business$categories)) , decreasing = TRUE) [1:30]
```

We pick up Fast Food and Chinese resturant as the cases.

# Baysian Belief Network

Modifications on the variables
1. Delete the variables less than 50% observations
2. Transfer all attribute vectors to numerics. 

# Explore category data in BBN

Fixed: categories

## variables in analysis
Primary: stars
secondary: Loc(city),  neighbors(numbers), hours(types), open(T, F)
Third: attributes(numbers, NA -> 0, 1 -> 2, 2 -> 3, etc.)

## Summary after exploration
Fast food in each city has a specific set of variables to influence the stars
People evalute the Chinese resturants on a specific attributes rather than a score. Generally the attributes are "Outdoor.Seating" and "Has.TV".

# Build prediction model for Fastfood in each city.
